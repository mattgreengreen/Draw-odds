<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draw Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0a0a0b;
            --surface: #151518;
            --elevated: #1e1e24;
            --border: #2a2a32;
            --text: #f0f0f5;
            --muted: #6b6b78;
            --a: #ff5f5f;
            --b: #ffc46b;
            --c: #4ecdc4;
            --either: #a78bfa;
            --other: #3a3a42;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .subtitle {
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 24px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .deck-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .tier-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            grid-column: 1 / -1;
        }
        
        @media (max-width: 600px) {
            .controls {
                grid-template-columns: 1fr;
            }
            .deck-controls {
                grid-template-columns: 1fr 1fr;
            }
            .tier-controls {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--muted);
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .number-input {
            background: var(--elevated);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 12px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            width: 100%;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .number-input:focus {
            outline: none;
            border-color: var(--text);
        }
        
        .tier-a:focus { border-color: var(--a); }
        .tier-b:focus { border-color: var(--b); }
        .tier-c:focus { border-color: var(--c); }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: var(--elevated);
            border-radius: 3px;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--text);
            border-radius: 50%;
            cursor: pointer;
        }
        
        .deck-viz {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 24px;
            min-height: 40px;
        }
        
        .deck-card {
            width: 24px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
        }
        
        .deck-card.a { background: var(--a); color: #000; }
        .deck-card.b { background: var(--b); color: #000; }
        .deck-card.c { background: var(--c); color: #000; }
        .deck-card.other { background: var(--other); }
        
        .view-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .view-btn {
            background: var(--elevated);
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .view-btn:hover {
            border-color: var(--text);
            color: var(--text);
        }
        
        .view-btn.active {
            background: var(--text);
            color: var(--bg);
            border-color: var(--text);
        }
        
        .prob-grid {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .prob-grid.active {
            display: grid;
        }
        
        .prob-cell {
            background: var(--elevated);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .prob-cell:hover {
            transform: translateY(-2px);
            border-color: var(--text);
        }
        
        .prob-cell:active {
            transform: translateY(0);
        }
        
        .prob-cell .tier {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .prob-cell.a .tier { color: var(--a); }
        .prob-cell.b .tier { color: var(--b); }
        .prob-cell.c .tier { color: var(--c); }
        .prob-cell.e .tier { color: var(--either); }
        
        .prob-cell .target {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 8px;
        }
        
        .prob-cell .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 600;
        }
        
        .bar-graph {
            display: none;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .bar-graph.active {
            display: flex;
        }
        
        .bar-row {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--elevated);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .bar-row:hover {
            border-color: var(--text);
            background: var(--bg);
        }
        
        .bar-label {
            width: 60px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .bar-row.a .bar-label { color: var(--a); }
        .bar-row.b .bar-label { color: var(--b); }
        .bar-row.c .bar-label { color: var(--c); }
        .bar-row.e .bar-label { color: var(--either); }
        
        .bar-track {
            flex: 1;
            height: 24px;
            background: var(--bg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .bar-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.4s ease;
            position: relative;
        }
        
        .bar-row.a .bar-fill { background: linear-gradient(90deg, var(--a), #ff8a8a); }
        .bar-row.b .bar-fill { background: linear-gradient(90deg, var(--b), #ffd89a); }
        .bar-row.c .bar-fill { background: linear-gradient(90deg, var(--c), #7eddd6); }
        .bar-row.e .bar-fill { background: linear-gradient(90deg, var(--either), #c4b5fd); }
        
        .bar-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            color: #000;
            text-shadow: 0 0 2px rgba(255,255,255,0.5);
        }
        
        .bar-percent {
            width: 60px;
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 600;
        }
        
        .radar-view {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .radar-view.active {
            display: flex;
        }
        
        .radar-container {
            position: relative;
            width: 350px;
            height: 350px;
        }
        
        .radar-svg {
            width: 100%;
            height: 100%;
        }
        
        .radar-axis {
            stroke: var(--border);
            stroke-width: 1;
        }
        
        .radar-grid {
            fill: none;
            stroke: var(--border);
            stroke-width: 1;
            opacity: 0.5;
        }
        
        .radar-area {
            fill-opacity: 0.3;
            stroke-width: 2;
            transition: all 0.4s ease;
        }
        
        .radar-point {
            r: 4;
            stroke: var(--surface);
            stroke-width: 2;
            transition: all 0.4s ease;
            cursor: pointer;
        }
        
        .radar-point:hover {
            r: 6;
        }
        
        .radar-label {
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        .radar-legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .radar-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        
        .radar-legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            opacity: 0.7;
        }
        
        .custom-calc {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        
        .custom-title {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .custom-inputs {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .custom-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--elevated);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .custom-group span {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .custom-group.a span { color: var(--a); }
        .custom-group.b span { color: var(--b); }
        .custom-group.c span { color: var(--c); }
        
        .custom-group input {
            width: 50px;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 6px;
            border-radius: 6px;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .custom-group.error {
            border-color: var(--a);
            background: rgba(255, 95, 95, 0.1);
        }
        
        .custom-result {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--elevated);
            padding: 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .custom-result.error {
            border-color: var(--a);
        }
        
        .custom-result.success {
            border-color: var(--c);
        }
        
        .formula {
            color: var(--muted);
            font-size: 14px;
        }
        
        .formula strong {
            color: var(--text);
        }
        
        .formula .a { color: var(--a); }
        .formula .b { color: var(--b); }
        .formula .c { color: var(--c); }
        
        .result-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 28px;
            font-weight: 600;
        }
        
        .result-value.error {
            color: var(--a);
            font-size: 14px;
        }
        
        .options {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--muted);
            cursor: pointer;
        }
        
        .option input {
            cursor: pointer;
        }
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>Draw Calculator</h1>
            <div class="subtitle">Probability Calculator</div>
            
            <div class="controls">
                <div class="deck-controls">
                    <div class="input-group">
                        <label>Deck Size</label>
                        <input type="number" class="number-input" id="deckNum" value="52" min="1" max="100" onchange="updateFromNum('deck')">
                        <input type="range" id="deckSlider" min="1" max="100" value="52" oninput="updateFromSlider('deck')">
                    </div>
                    
                    <div class="input-group">
                        <label>Cards to Draw</label>
                        <input type="number" class="number-input" id="drawNum" value="5" min="1" max="100" onchange="updateFromNum('draw')">
                        <input type="range" id="drawSlider" min="1" max="100" value="5" oninput="updateFromSlider('draw')">
                    </div>
                </div>
                
                <div class="tier-controls">
                    <div class="input-group">
                        <label>Tier A Cards</label>
                        <input type="number" class="number-input tier-a" id="tierA" value="4" min="0" onchange="calculate()">
                    </div>
                    
                    <div class="input-group">
                        <label>Tier B Cards</label>
                        <input type="number" class="number-input tier-b" id="tierB" value="0" min="0" onchange="calculate()">
                    </div>
                    
                    <div class="input-group">
                        <label>Tier C Cards</label>
                        <input type="number" class="number-input tier-c" id="tierC" value="0" min="0" onchange="calculate()">
                    </div>
                </div>
            </div>
            
            <div class="deck-viz" id="deckViz"></div>
            
            <div class="view-toggle">
                <button class="view-btn" onclick="setView('grid')">Grid View</button>
                <button class="view-btn active" onclick="setView('bars')">Bar Graph</button>
                <button class="view-btn" onclick="setView('radar')">Radar Chart</button>
            </div>
            
            <div class="prob-grid" id="probGrid"></div>
            <div class="bar-graph active" id="barGraph"></div>
            <div class="radar-view" id="radarView"></div>
            
            <div class="custom-calc">
                <div class="custom-title">Custom Combination — Click probabilities above</div>
                <div class="custom-inputs">
                    <div class="custom-group a" id="cgA">
                        <span>A</span>
                        <input type="number" id="wantA" value="1" min="0" onchange="calcCustom()">
                    </div>
                    <div class="custom-group b" id="cgB">
                        <span>B</span>
                        <input type="number" id="wantB" value="0" min="0" onchange="calcCustom()">
                    </div>
                    <div class="custom-group c" id="cgC">
                        <span>C</span>
                        <input type="number" id="wantC" value="0" min="0" onchange="calcCustom()">
                    </div>
                </div>
                <div class="custom-result" id="customResult">
                    <div class="formula" id="formula">Select cards to calculate</div>
                    <div class="result-value" id="resultValue">--</div>
                </div>
            </div>
            
            <div class="options">
                <label class="option"><input type="checkbox" id="showEither" onchange="calculate()"> Show Either</label>
                <label class="option"><input type="checkbox" id="showCombos" onchange="calculate()"> Show Combos</label>
            </div>
        </div>
    </div>

    <script>
        let currentView = 'bars';
        let lastProbs = [];
        
        function nCr(n, r) {
            if (r < 0 || r > n) return 0;
            if (r === 0 || r === n) return 1;
            let res = 1;
            for (let i = 0; i < r; i++) {
                res = res * (n - i) / (i + 1);
            }
            return res;
        }
        
        function hypergeometric(N, K, n, k) {
            return nCr(K, k) * nCr(N - K, n - k) / nCr(N, n);
        }
        
        function cumulative(N, K, n, minK) {
            let sum = 0;
            for (let k = minK; k <= Math.min(K, n); k++) {
                sum += hypergeometric(N, K, n, k);
            }
            return sum;
        }
        
        function exactMulti(N, A, B, C, n, a, b, c) {
            const other = N - A - B - C;
            const needOther = n - a - b - c;
            if (needOther < 0 || needOther > other) return 0;
            if (a > A || b > B || c > C) return 0;
            return nCr(A, a) * nCr(B, b) * nCr(C, c) * nCr(other, needOther) / nCr(N, n);
        }
        
        function formatPct(p) {
            if (p < 0.001) return "<0.1%";
            if (p > 0.999) return ">99.9%";
            return (p * 100).toFixed(1) + "%";
        }
        
        function getVals() {
            return {
                N: parseInt(document.getElementById('deckNum').value) || 52,
                n: parseInt(document.getElementById('drawNum').value) || 5,
                A: parseInt(document.getElementById('tierA').value) || 0,
                B: parseInt(document.getElementById('tierB').value) || 0,
                C: parseInt(document.getElementById('tierC').value) || 0
            };
        }
        
        function updateFromSlider(type) {
            const slider = document.getElementById(type + 'Slider');
            document.getElementById(type + 'Num').value = slider.value;
            calculate();
        }
        
        function updateFromNum(type) {
            const num = document.getElementById(type + 'Num');
            let val = parseInt(num.value) || 1;
            const slider = document.getElementById(type + 'Slider');
            val = Math.max(parseInt(slider.min), Math.min(parseInt(slider.max), val));
            num.value = val;
            slider.value = val;
            calculate();
        }
        
        function setView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('probGrid').classList.remove('active');
            document.getElementById('barGraph').classList.remove('active');
            document.getElementById('radarView').classList.remove('active');
            
            if (view === 'grid') {
                document.getElementById('probGrid').classList.add('active');
            } else if (view === 'bars') {
                document.getElementById('barGraph').classList.add('active');
            } else {
                document.getElementById('radarView').classList.add('active');
            }
            renderView();
        }
        
        function setWant(a, b, c) {
            document.getElementById('wantA').value = a;
            document.getElementById('wantB').value = b;
            document.getElementById('wantC').value = c;
            calcCustom();
        }
        
        function renderView() {
            if (currentView === 'grid') {
                renderGrid();
            } else if (currentView === 'bars') {
                renderBars();
            } else {
                renderRadar();
            }
        }
        
        function renderGrid() {
            const grid = document.getElementById('probGrid');
            grid.innerHTML = '';
            
            lastProbs.forEach(p => {
                const div = document.createElement('div');
                div.className = 'prob-cell ' + p.class;
                div.innerHTML = `
                    <div class="tier">${p.tier}</div>
                    <div class="target">${p.target}</div>
                    <div class="value">${formatPct(p.prob)}</div>
                `;
                div.onclick = () => setWant(p.setA, p.setB, p.setC);
                grid.appendChild(div);
            });
        }
        
        function renderBars() {
            const container = document.getElementById('barGraph');
            container.innerHTML = '';
            
            lastProbs.forEach(p => {
                const row = document.createElement('div');
                row.className = 'bar-row ' + p.class;
                row.onclick = () => setWant(p.setA, p.setB, p.setC);
                
                const width = Math.max(p.prob * 100, 1);
                
                row.innerHTML = `
                    <div class="bar-label">${p.tier}</div>
                    <div class="bar-track">
                        <div class="bar-fill" style="width: ${width}%">
                            ${width > 15 ? `<span class="bar-value">${formatPct(p.prob)}</span>` : ''}
                        </div>
                    </div>
                    <div class="bar-percent">${formatPct(p.prob)}</div>
                `;
                container.appendChild(row);
            });
        }
        
        function renderRadar() {
            const container = document.getElementById('radarView');
            container.innerHTML = '';
            
            const v = getVals();
            
            // Get probabilities for 1, 2, 3, 4, 5 cards
            const axes = ['1', '2', '3', '4', '5+'];
            const data = {
                A: [],
                B: [],
                C: []
            };
            
            for (let i = 0; i < 5; i++) {
                const count = i + 1;
                if (v.A > 0 && count <= v.A && count <= v.n) {
                    data.A.push(cumulative(v.N, v.A, v.n, count));
                } else {
                    data.A.push(0);
                }
                
                if (v.B > 0 && count <= v.B && count <= v.n) {
                    data.B.push(cumulative(v.N, v.B, v.n, count));
                } else {
                    data.B.push(0);
                }
                
                if (v.C > 0 && count <= v.C && count <= v.n) {
                    data.C.push(cumulative(v.N, v.C, v.n, count));
                } else {
                    data.C.push(0);
                }
            }
            
            const colors = {
                A: '#ff5f5f',
                B: '#ffc46b',
                C: '#4ecdc4'
            };
            
            const centerX = 175;
            const centerY = 175;
            const radius = 120;
            const angleStep = (2 * Math.PI) / 5;
            
            let svgHTML = `<svg class="radar-svg" viewBox="0 0 350 350">`;
            
            // Draw grid circles
            for (let i = 1; i <= 4; i++) {
                const r = (radius / 4) * i;
                let points = [];
                for (let j = 0; j < 5; j++) {
                    const angle = j * angleStep - Math.PI / 2;
                    points.push(`${centerX + Math.cos(angle) * r},${centerY + Math.sin(angle) * r}`);
                }
                svgHTML += `<polygon class="radar-grid" points="${points.join(' ')}"/>`;
            }
            
            // Draw axes
            for (let i = 0; i < 5; i++) {
                const angle = i * angleStep - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                svgHTML += `<line class="radar-axis" x1="${centerX}" y1="${centerY}" x2="${x}" y2="${y}"/>`;
                
                // Labels
                const labelX = centerX + Math.cos(angle) * (radius + 25);
                const labelY = centerY + Math.sin(angle) * (radius + 25);
                svgHTML += `<text class="radar-label" x="${labelX}" y="${labelY}" fill="#6b6b78">${axes[i]}</text>`;
            }
            
            // Draw data areas
            ['A', 'B', 'C'].forEach(tier => {
                if (v[tier] === 0) return;
                
                let points = [];
                let hasData = false;
                
                data[tier].forEach((prob, i) => {
                    if (prob > 0) hasData = true;
                    const angle = i * angleStep - Math.PI / 2;
                    const r = prob * radius;
                    points.push(`${centerX + Math.cos(angle) * r},${centerY + Math.sin(angle) * r}`);
                });
                
                if (hasData) {
                    svgHTML += `<polygon class="radar-area" points="${points.join(' ')}" 
                        fill="${colors[tier]}" stroke="${colors[tier]}"/>`;
                    
                    // Draw points
                    data[tier].forEach((prob, i) => {
                        if (prob > 0) {
                            const angle = i * angleStep - Math.PI / 2;
                            const r = prob * radius;
                            const x = centerX + Math.cos(angle) * r;
                            const y = centerY + Math.sin(angle) * r;
                            svgHTML += `<circle class="radar-point" cx="${x}" cy="${y}" fill="${colors[tier]}" 
                                onclick="setWant(${tier === 'A' ? i + 1 : 0}, ${tier === 'B' ? i + 1 : 0}, ${tier === 'C' ? i + 1 : 0})"/>`;
                        }
                    });
                }
            });
            
            svgHTML += '</svg>';
            
            // Legend
            let legendHTML = '<div class="radar-legend">';
            ['A', 'B', 'C'].forEach(tier => {
                if (v[tier] > 0) {
                    legendHTML += `
                        <div class="radar-legend-item">
                            <div class="radar-legend-color" style="background: ${colors[tier]}"></div>
                            <span>Tier ${tier}</span>
                        </div>
                    `;
                }
            });
            legendHTML += '</div>';
            
            container.innerHTML = svgHTML + legendHTML;
        }
        
        function calculate() {
            let v = getVals();
            
            const totalTier = v.A + v.B + v.C;
            if (totalTier > v.N) {
                v.A = Math.floor(v.A * v.N / totalTier);
                v.B = Math.floor(v.B * v.N / totalTier);
                v.C = v.N - v.A - v.B;
                document.getElementById('tierA').value = v.A;
                document.getElementById('tierB').value = v.B;
                document.getElementById('tierC').value = v.C;
            }
            if (v.n > v.N) {
                v.n = v.N;
                document.getElementById('drawNum').value = v.n;
                document.getElementById('drawSlider').value = v.n;
            }
            
            const viz = document.getElementById('deckViz');
            let html = '';
            for (let i = 0; i < v.A; i++) html += '<div class="deck-card a">A</div>';
            for (let i = 0; i < v.B; i++) html += '<div class="deck-card b">B</div>';
            for (let i = 0; i < v.C; i++) html += '<div class="deck-card c">C</div>';
            const other = Math.min(v.N - v.A - v.B - v.C, 30);
            for (let i = 0; i < other; i++) html += '<div class="deck-card other"></div>';
            viz.innerHTML = html;
            
            lastProbs = [];
            
            [['A', v.A], ['B', v.B], ['C', v.C]].forEach(([tier, count]) => {
                if (count === 0) return;
                const maxShow = Math.min(5, count, v.n);
                for (let k = 1; k <= maxShow; k++) {
                    lastProbs.push({
                        tier: tier,
                        target: k + '+',
                        prob: cumulative(v.N, count, v.n, k),
                        class: tier.toLowerCase(),
                        setA: tier === 'A' ? k : 0,
                        setB: tier === 'B' ? k : 0,
                        setC: tier === 'C' ? k : 0
                    });
                }
            });
            
            if (document.getElementById('showEither').checked && totalTier > 0) {
                const maxShow = Math.min(5, totalTier, v.n);
                for (let k = 1; k <= maxShow; k++) {
                    lastProbs.push({
                        tier: 'Any',
                        target: k + '+',
                        prob: cumulative(v.N, totalTier, v.n, k),
                        class: 'e',
                        setA: Math.min(k, v.A),
                        setB: Math.min(k, v.B),
                        setC: Math.min(k, v.C)
                    });
                }
            }
            
            if (document.getElementById('showCombos').checked) {
                const combos = [];
                if (v.A > 0 && v.B > 0) {
                    let prob = 0;
                    for (let a = 1; a <= Math.min(v.A, v.n); a++) {
                        for (let b = 1; b <= Math.min(v.B, v.n - a); b++) {
                            prob += exactMulti(v.N, v.A, v.B, v.C, v.n, a, b, 0);
                        }
                    }
                    combos.push({name: 'A+B', a: 1, b: 1, c: 0, prob});
                }
                if (v.A > 0 && v.C > 0) {
                    let prob = 0;
                    for (let a = 1; a <= Math.min(v.A, v.n); a++) {
                        for (let c = 1; c <= Math.min(v.C, v.n - a); c++) {
                            prob += exactMulti(v.N, v.A, v.B, v.C, v.n, a, 0, c);
                        }
                    }
                    combos.push({name: 'A+C', a: 1, b: 0, c: 1, prob});
                }
                if (v.B > 0 && v.C > 0) {
                    let prob = 0;
                    for (let b = 1; b <= Math.min(v.B, v.n); b++) {
                        for (let c = 1; c <= Math.min(v.C, v.n - b); c++) {
                            prob += exactMulti(v.N, v.A, v.B, v.C, v.n, 0, b, c);
                        }
                    }
                    combos.push({name: 'B+C', a: 0, b: 1, c: 1, prob});
                }
                if (v.A > 0 && v.B > 0 && v.C > 0) {
                    let prob = 0;
                    for (let a = 1; a <= Math.min(v.A, v.n); a++) {
                        for (let b = 1; b <= Math.min(v.B, v.n - a); b++) {
                            for (let c = 1; c <= Math.min(v.C, v.n - a - b); c++) {
                                prob += exactMulti(v.N, v.A, v.B, v.C, v.n, a, b, c);
                            }
                        }
                    }
                    combos.push({name: 'A+B+C', a: 1, b: 1, c: 1, prob});
                }
                
                combos.forEach(c => {
                    lastProbs.push({
                        tier: c.name,
                        target: '1+ each',
                        prob: c.prob,
                        class: '',
                        setA: c.a,
                        setB: c.b,
                        setC: c.c
                    });
                });
            }
            
            renderView();
            calcCustom();
        }
        
        function calcCustom() {
            const v = getVals();
            const wantA = parseInt(document.getElementById('wantA').value) || 0;
            const wantB = parseInt(document.getElementById('wantB').value) || 0;
            const wantC = parseInt(document.getElementById('wantC').value) || 0;
            
            document.getElementById('cgA').classList.remove('error');
            document.getElementById('cgB').classList.remove('error');
            document.getElementById('cgC').classList.remove('error');
            document.getElementById('customResult').classList.remove('error', 'success');
            
            const errors = [];
            if (wantA > v.A) {
                errors.push(`Only ${v.A} A available`);
                document.getElementById('cgA').classList.add('error');
            }
            if (wantB > v.B) {
                errors.push(`Only ${v.B} B available`);
                document.getElementById('cgB').classList.add('error');
            }
            if (wantC > v.C) {
                errors.push(`Only ${v.C} C available`);
                document.getElementById('cgC').classList.add('error');
            }
            if (wantA + wantB + wantC > v.n) {
                errors.push(`Can only draw ${v.n}`);
            }
            if (wantA + wantB + wantC === 0) {
                errors.push('Select at least 1 card');
            }
            
            const formula = document.getElementById('formula');
            const result = document.getElementById('resultValue');
            
            if (errors.length > 0) {
                formula.innerHTML = `<span style="color: #ff5f5f">${errors.join(' • ')}</span>`;
                result.textContent = 'Invalid';
                result.className = 'result-value error';
                document.getElementById('customResult').classList.add('error');
                return;
            }
            
            const prob = exactMulti(v.N, v.A, v.B, v.C, v.n, wantA, wantB, wantC);
            
            const parts = [];
            if (wantA > 0) parts.push(`<strong style="color: #ff5f5f">${wantA}A</strong>`);
            if (wantB > 0) parts.push(`<strong style="color: #ffc46b">${wantB}B</strong>`);
            if (wantC > 0) parts.push(`<strong style="color: #4ecdc4">${wantC}C</strong>`);
            
            formula.innerHTML = `Exactly ${parts.join(' + ')}`;
            result.textContent = formatPct(prob);
            result.className = 'result-value';
            document.getElementById('customResult').classList.add('success');
        }
        
        calculate();
    </script>
</body>
</html>
